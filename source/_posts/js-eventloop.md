---
title: 浏览器eventLoop
categories: [js]
tags: []
toc: true
date: 2021/1/18
---

## 任务队列

任务可以分成两种，一种是同步任务（synchronous），另一种是异步任务（asynchronous）

**同步任务**指的是，**在主线程上排队执行的任务**，只有前一个任务执行完毕，才能执行后一个任务；

**异步任务**指的是，**不进入主线程**、而**进入"任务队列"（task queue）**的任务，只有"任务队列"通知主线程，某个异步任务可以执行了，该任务才会进入主线程执行。

**任务队列**指的是，js 引擎遇到一个异步任务后并不会一直等待其返回结果，而是会将这个任务挂起，继续执行执行栈中的其他任务。**当一个异步任务返回结果后，js 会将这个任务加入与当前执行栈不同的另一个队列，我们称之为任务队列**。

**Event Loop**指的是，被放入任务队列不会立刻执行其回调，而是**等待当前执行栈中的所有任务都执行完毕， 主线程处于闲置状态时**，主线程会去**查找任务队列**是否有任务。如果有，那么主线程会从中取出排在第一位的任务，并把这个任务对应的回调放入执行栈中，然后**执行其中的同步代码**...，如此反复，这样就形成了一个无限的循环。这就是这个过程被称为“Event Loop”的原因。

## macro task 和 microTask

异步任务之间的执行优先级也不同，不同的异步任务分为两类：微任务 microTask, 宏任务 macroTask

宏任务：setInterval, setTimeout，I/O 操作

微任务：Promise, MutationObserver(DOM 修改监视)

## EventLoop 下异步任务执行的顺序

当前执行栈执行完毕时会立刻*先处理所有微任务队列中的事件*，然后*再去处理宏任务队列中事件*。_同一次事件循环中，微任务永远在宏任务之前执行_。
